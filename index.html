<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NeonMail Direct (Hostinger SMTP)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://smtpjs.com/v3/smtp.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { background-color: #050505; color: #e5e7eb; font-family: 'Inter', sans-serif; background-image: radial-gradient(circle at top right, #1a2e1a 0%, #000 40%); }
        .glass-panel { background: rgba(20, 20, 20, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; }
        .input-dark { background: rgba(0, 0, 0, 0.5); border: 1px solid #333; color: #fff; transition: all 0.3s; }
        .input-dark:focus { border-color: #ff003c; outline: none; } /* Vermelho agressivo para indicar modo inseguro/direto */
        .btn-neon { background: #ff003c; color: #fff; font-weight: 800; text-transform: uppercase; transition: all 0.3s; }
        .btn-neon:hover { transform: translateY(-2px); box-shadow: 0 0 15px rgba(255, 0, 60, 0.5); }
        .btn-neon:disabled { background: #333; color: #666; cursor: not-allowed; transform: none; box-shadow: none; }
        .tag-var { background: #1f2937; border: 1px solid #374151; color: #ff003c; font-size: 0.75rem; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8">

    <div class="max-w-6xl mx-auto flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold tracking-tighter text-white">NEON<span class="text-[#ff003c]">MAIL</span> <span class="text-xs bg-red-900 text-white px-2 py-1 rounded">DIRECT SMTP</span></h1>
        </div>
        <div class="flex items-center gap-2 text-[#ff003c]">
            <span class="w-2 h-2 bg-[#ff003c] rounded-full animate-pulse"></span> MODO DIRETO
        </div>
    </div>

    <div class="max-w-6xl mx-auto mb-6 bg-red-900/20 border border-red-600 text-red-200 p-4 rounded text-xs font-mono">
        <i class="fas fa-unlock"></i> AVISO: As credenciais SMTP estão hardcoded neste arquivo. Qualquer pessoa que inspecionar o código poderá vê-las.
    </div>

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-6">
        <div class="lg:col-span-1 space-y-6">
            <div class="glass-panel p-6">
                <h2 class="text-lg font-bold mb-4 flex items-center gap-2"><i class="fas fa-cog text-gray-400"></i> Configuração</h2>
                <form id="campaignForm" class="space-y-4">
                    <div class="opacity-50 pointer-events-none">
                        <label class="text-xs text-gray-500 uppercase font-bold">SMTP User</label>
                        <input type="text" value="contato@cristianefranklin.com" class="input-dark w-full p-2 rounded text-xs" readonly>
                    </div>
                    
                    <div>
                        <label class="text-xs text-gray-400 uppercase font-bold">Lista CSV</label>
                        <input type="file" id="csvFile" accept=".csv" required class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-[#ff003c] file:text-white hover:file:bg-red-700 cursor-pointer">
                    </div>
                    <div>
                        <label class="text-xs text-gray-400 uppercase font-bold flex justify-between">
                            Delay (Segundos): <span id="delayVal" class="text-[#ff003c]">3s</span>
                        </label>
                        <input type="range" id="delayRange" min="1" max="10" value="3" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[#ff003c]">
                    </div>
                </form>
            </div>

            <div class="glass-panel p-6">
                <h2 class="text-lg font-bold mb-4"><i class="fas fa-chart-pie text-gray-400"></i> Progresso</h2>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div class="bg-black/30 p-2 rounded text-center"><div class="text-[10px] text-gray-500">TOTAL</div><div id="stat-total" class="text-lg font-bold text-white">0</div></div>
                    <div class="bg-black/30 p-2 rounded text-center"><div class="text-[10px] text-gray-500">PENDENTE</div><div id="stat-pending" class="text-lg font-bold text-yellow-500">0</div></div>
                    <div class="bg-black/30 p-2 rounded text-center"><div class="text-[10px] text-gray-500">ENVIADOS</div><div id="stat-sent" class="text-lg font-bold text-[#ff003c]">0</div></div>
                    <div class="bg-black/30 p-2 rounded text-center"><div class="text-[10px] text-gray-500">ERROS</div><div id="stat-error" class="text-lg font-bold text-red-500">0</div></div>
                </div>
                <div class="w-full bg-gray-800 rounded-full h-2 mb-2"><div id="progressBar" class="bg-[#ff003c] h-2 rounded-full transition-all" style="width: 0%"></div></div>
                <div class="text-center text-xs text-gray-400" id="progressText">0%</div>
            </div>
        </div>

        <div class="lg:col-span-2 space-y-6">
            <div class="glass-panel p-6 border-t-2 border-[#ff003c]">
                <h2 class="text-lg font-bold mb-4"><i class="fas fa-pen-nib text-gray-400"></i> Editor</h2>
                <input type="text" id="subject" class="input-dark w-full p-3 rounded-lg text-lg font-bold mb-4" placeholder="Assunto do E-mail..." required>
                
                <div class="flex gap-2 mb-2">
                    <button type="button" class="tag-var" onclick="insertVar('{Nome}')">{Nome}</button>
                    <button type="button" class="tag-var" onclick="insertVar('{Email}')">{Email}</button>
                    <button type="button" class="tag-var" onclick="insertVar('{CPF}')">{CPF}</button>
                </div>
                
                <textarea id="msgBody" rows="8" class="input-dark w-full p-3 rounded-lg font-mono text-sm" placeholder="Sua mensagem HTML..." required></textarea>
                
                <div class="mt-6 flex gap-3">
                    <button type="button" onclick="startSending()" id="btnAction" class="btn-neon flex-1 py-4 rounded-lg text-lg shadow-lg flex justify-center items-center gap-2">
                        <i class="fas fa-paper-plane"></i> DISPARAR COM HOSTINGER
                    </button>
                    <button type="button" onclick="stopSystem()" id="btnStop" class="hidden flex-1 py-4 rounded-lg text-lg bg-gray-600 text-white font-bold hover:bg-gray-700">
                        <i class="fas fa-stop"></i> PARAR
                    </button>
                </div>
            </div>

            <div class="glass-panel p-4 h-64 flex flex-col">
                <div class="flex justify-between items-center mb-2"><span class="text-xs font-mono text-gray-500">LOGS SMTP</span> <button onclick="document.getElementById('logContainer').innerHTML = ''" class="text-xs text-gray-600">Limpar</button></div>
                <div id="logContainer" class="flex-1 overflow-y-auto font-mono text-xs space-y-1 p-2 bg-black/50 rounded border border-gray-800"></div>
            </div>
        </div>
    </div>

    <script>
        // --- CREDENCIAIS HOSTINGER (INSERIDAS) ---
        const SMTP_CONFIG = {
            Host: "smtp.hostinger.com",
            Username: "contato@cristianefranklin.com",
            Password: "@Sobre8877", 
            From: "contato@cristianefranklin.com" // Hostinger exige que o From seja igual ao usuário autenticado
        };

        const delayRange = document.getElementById('delayRange');
        const delayVal = document.getElementById('delayVal');
        delayRange.addEventListener('input', function() { delayVal.innerText = this.value + 's'; });

        function insertVar(text) { 
            let el = document.getElementById('msgBody');
            let start = el.selectionStart;
            el.value = el.value.substring(0, start) + text + el.value.substring(el.selectionEnd);
            el.focus();
            el.selectionEnd = start + text.length; 
        }

        let isRunning = false;
        let queue = [];
        let totalSent = 0;
        let totalError = 0;
        let currentIndex = 0;

        function addLog(msg, type='info') {
            let color = type === 'success' ? 'text-[#ff003c]' : (type === 'error' ? 'text-red-500' : 'text-gray-400');
            const logBox = document.getElementById('logContainer');
            logBox.innerHTML = `<div class="${color} border-b border-white/5 pb-1">[${new Date().toLocaleTimeString()}] ${msg}</div>` + logBox.innerHTML;
        }

        function startSending() {
            const fileInput = document.getElementById('csvFile');
            const subject = document.getElementById('subject').value;
            const body = document.getElementById('msgBody').value;

            if (fileInput.files.length === 0) return alert("Selecione um arquivo CSV!");
            if (!subject || !body) return alert("Preencha o Assunto e a Mensagem!");

            document.getElementById('btnAction').disabled = true;
            document.getElementById('btnAction').innerHTML = '<i class="fas fa-spinner fa-spin"></i> LENDO CSV...';

            Papa.parse(fileInput.files[0], {
                header: false,
                skipEmptyLines: true,
                complete: function(results) {
                    let data = results.data;
                    
                    // Remove cabeçalho se existir
                    if(data[0][1] && (data[0][1].toLowerCase().includes('email') || !data[0][1].includes('@'))) {
                        data.shift();
                    }

                    queue = data.filter(row => row[1] && row[1].includes('@'));
                    
                    if(queue.length === 0) {
                        document.getElementById('btnAction').disabled = false;
                        document.getElementById('btnAction').innerHTML = 'DISPARAR COM HOSTINGER';
                        return alert("Nenhum e-mail válido encontrado no CSV.");
                    }

                    document.getElementById('stat-total').innerText = queue.length;
                    document.getElementById('stat-pending').innerText = queue.length;
                    document.getElementById('stat-sent').innerText = "0";
                    document.getElementById('stat-error').innerText = "0";
                    totalSent = 0; totalError = 0; currentIndex = 0;

                    document.getElementById('btnAction').classList.add('hidden');
                    document.getElementById('btnStop').classList.remove('hidden');
                    addLog(`Iniciando envio para ${queue.length} contatos usando SMTP.js...`, 'info');
                    
                    isRunning = true;
                    processNext();
                }
            });
        }

        function processNext() {
            if (!isRunning || currentIndex >= queue.length) {
                finishJob();
                return;
            }

            const row = queue[currentIndex];
            const lead = {
                nome: row[0] || '',
                email: row[1].trim(),
                cpf: row[2] || '',
                telefone: row[3] || ''
            };

            const rawBody = document.getElementById('msgBody').value;
            const rawSubject = document.getElementById('subject').value;

            // Variáveis
            let finalBody = rawBody
                .replace(/{Nome}/g, lead.nome)
                .replace(/{Email}/g, lead.email)
                .replace(/{CPF}/g, lead.cpf);
            
            let finalSubject = rawSubject.replace(/{Nome}/g, lead.nome);

            // ENVIO VIA SMTP.JS
            Email.send({
                Host : SMTP_CONFIG.Host,
                Username : SMTP_CONFIG.Username,
                Password : SMTP_CONFIG.Password,
                To : lead.email,
                From : SMTP_CONFIG.From,
                Subject : finalSubject,
                Body : finalBody
            }).then(
              message => {
                if (message === "OK") {
                    totalSent++;
                    document.getElementById('stat-sent').innerText = totalSent;
                    addLog(`ENVIADO: ${lead.email}`, 'success');
                } else {
                    totalError++;
                    document.getElementById('stat-error').innerText = totalError;
                    addLog(`FALHA: ${lead.email} - ${message}`, 'error');
                }
                
                nextStep();
              }
            ).catch(err => {
                totalError++;
                document.getElementById('stat-error').innerText = totalError;
                addLog(`ERRO CRÍTICO: ${lead.email} - ${err}`, 'error');
                nextStep();
            });
        }

        function nextStep() {
            currentIndex++;
            document.getElementById('stat-pending').innerText = queue.length - currentIndex;
            let pct = Math.round((currentIndex / queue.length) * 100);
            document.getElementById('progressBar').style.width = pct + '%';
            document.getElementById('progressText').innerText = pct + '%';

            const delay = parseInt(document.getElementById('delayRange').value) * 1000;
            if (isRunning) setTimeout(processNext, delay);
        }

        function stopSystem() {
            isRunning = false;
            addLog('Parado pelo usuário.', 'info');
            document.getElementById('btnStop').classList.add('hidden');
            document.getElementById('btnAction').classList.remove('hidden');
            document.getElementById('btnAction').disabled = false;
            document.getElementById('btnAction').innerHTML = 'CONTINUAR';
        }

        function finishJob() {
            isRunning = false;
            addLog('LISTA CONCLUÍDA.', 'success');
            document.getElementById('progressBar').style.width = '100%';
            document.getElementById('progressBar').classList.add('bg-green-500');
            document.getElementById('btnStop').classList.add('hidden');
            document.getElementById('btnAction').classList.remove('hidden');
            document.getElementById('btnAction').disabled = false;
            document.getElementById('btnAction').innerHTML = 'NOVO DISPARO';
            alert('Envio finalizado!');
        }
    </script>
</body>
</html>
